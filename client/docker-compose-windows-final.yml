# 最终Windows容器模式配置

version: '3.8'

networks:
  erpcrm_network:
    driver: nat

volumes:
  app_data:
    driver: local

# Windows容器模式配置
services:
  # 基础服务 - 使用官方Windows Server Core镜像
  backend:
    image: mcr.microsoft.com/windows/servercore:ltsc2022
    container_name: erpcrm_backend
    networks:
      - erpcrm_network
    ports:
      - "8082:8080"
    restart: always
    environment:
      - SPRING_PROFILES_ACTIVE=default
      - APP_HOME=C:\app
    volumes:
      - app_data:C:\app\data
    command: >
      cmd /c "
      echo Starting ERP+CRM backend service...
      echo Application home: %APP_HOME%
      echo Creating data directory...
      mkdir -p %APP_HOME%\data
      echo Service is running on port 8080 (mapped to host 8082)
      echo This is a placeholder for the actual backend service.
      echo To deploy the full backend service, you need to:
      echo 1. Fix the compilation errors in the server code
      echo 2. Build the backend application with Maven
      echo 3. Create a Windows-compatible Dockerfile
      echo 4. Update this docker-compose.yml to use your custom image
      echo Service status: RUNNING
      # 保持容器运行
      ping -t localhost >nul
      "

  # MySQL数据库 - Windows兼容镜像
  mysql:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: erpcrm_mysql
    networks:
      - erpcrm_network
    ports:
      - "1433:1433"
    restart: always
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=ErpCrm123456
    volumes:
      - app_data:C:\sql_data
    command: >
      cmd /c "
      echo Starting SQL Server...
      echo Note: This is SQL Server, not MySQL, as there's no official Windows MySQL image.
      echo You can use this as a database or replace it with a Linux MySQL container in WSL.
      "
